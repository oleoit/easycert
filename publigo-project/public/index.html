<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EasyCert</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="logo.png">
</head>

<body>
  <div class="shell">
    <div class="card input-card">
      <div class="card-header">
        <img src="logo.png" alt="EasyCert Logo" class="logo-badge">
        <div>
          <h1 class="app-title" id="t-app-title">EasyCert by Yutthana</h1>
          <p class="app-subtitle" id="t-app-subtitle">‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÇ‡∏î‡∏¢ ‡∏¢‡∏∏‡∏ó‡∏ò‡∏ô‡∏≤</p>
        </div>

        <div class="lang-switch">
          <button class="lang-btn active" onclick="setLanguage('th')" id="btn-th">TH</button>
          <button class="lang-btn" onclick="setLanguage('en')" id="btn-en">EN</button>
        </div>
      </div>

      <form id="mergeForm" enctype="multipart/form-data">
        <div class="step-group">
          <label class="step-label" id="t-step1">1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Template (.docx / .pptx)</label>
          <div class="drop-zone" id="dropZoneTemplate">
            <input type="file" name="template" id="fileTemplate" accept=".docx,.pptx" required hidden />
            <div class="drop-content" id="contentTemplate">
              <span class="icon-upload">‚òÅÔ∏è</span>
              <span class="text-upload" id="t-drag-template">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Template ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å</span>
              <span class="subtext-upload">(.docx / .pptx)</span>
            </div>
            <div class="file-success" id="successTemplate">
              <span class="file-icon">üìÑ</span>
              <span class="filename" id="nameTemplate"></span>
              <span class="check-icon">‚úì</span>
            </div>
          </div>
          <p class="step-hint" id="t-hint1">‡πÉ‡∏ä‡πâ {{Tag}} ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå template ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ column ‡πÉ‡∏ô CSV</p>
        </div>

        <div class="step-group">
          <label class="step-label" id="t-step2">2) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (.csv)</label>
          <div class="drop-zone" id="dropZoneCsv">
            <input type="file" name="datafile" id="fileCsv" accept=".csv" required hidden />
            <div class="drop-content" id="contentCsv">
              <span class="icon-upload">üìä</span>
              <span class="text-upload" id="t-drag-csv">‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å</span>
              <span class="subtext-upload">(.csv)</span>
            </div>
            <div class="file-success" id="successCsv">
              <span class="file-icon">üìÑ</span>
              <span class="filename" id="nameCsv"></span>
              <span class="check-icon">‚úì</span>
            </div>
          </div>
          <p class="step-hint" id="t-hint2">‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ header ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å ‡πÄ‡∏ä‡πà‡∏ô Name, Date</p>
        </div>

        <div class="step-group">
          <label class="step-label" id="t-step3">3) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Output</label>
          <div class="select-wrapper">
            <select name="outputType" required>
              <option value="pdf" selected>PDF (.pdf)</option>
              <option value="png">Image (.png)</option>
              <option value="jpg">Image (.jpg)</option>
              <option value="docx">Word (.docx)</option>
              <option value="pptx">PowerPoint (.pptx)</option>
            </select>
          </div>
        </div>

        <button type="submit" id="submitBtn">‚ö° Generate documents</button>
      </form>

      <div class="footer-tip">
        <strong id="t-tip-label">Tip:</strong> <span id="t-tip-text">Column ‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á CSV ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô
          01_Somchai)</span>
      </div>
    </div>

    <div class="card result-card">
      <div class="result-header">
        <h2 class="result-title" id="t-result-title">üìÑ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>
        <div id="downloadAllContainer"></div>
      </div>

      <div id="resultContent" class="result-content-area">
        <div class="empty-state">
          <div class="empty-icon">‚ö°</div>
          <p id="t-result-empty">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Generate</p>
        </div>
      </div>
    </div>
  <div class="app-footer">
      <span id="t-footer">Developed by Yutthana P. ¬© 2025</span>
    </div>
  </div>

  <div class="overlay" id="errorOverlay">
    <div class="dialog">
      <div class="dialog-header">
        <div class="dialog-icon-error">!</div>
        <h3 id="t-error-title">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>
      </div>
      <div class="dialog-body" id="errorMessage"></div>
      <div class="dialog-footer">
        <button onclick="closeError()" id="t-error-close">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <script>
    /* --- Dictionary ‡∏†‡∏≤‡∏©‡∏≤ --- */
    const translations = {
      th: {
        appTitle: "EasyCert",
        appSubtitle: "‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå",
        step1: "1) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Template (.docx / .pptx)",
        dragTemplate: "‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå Template ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å",
        hint1: "‡πÉ‡∏ä‡πâ {{Tag}} ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå template ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠ column ‡πÉ‡∏ô CSV",
        step2: "2) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (.csv)",
        dragCsv: "‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå CSV ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å",
        hint2: "‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ header ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å ‡πÄ‡∏ä‡πà‡∏ô Name, Date",
        step3: "3) ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Output",
        btnGenerate: "‚ö° ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£",
        btnProcessing: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...",
        tipLabel: "Tip:",
        tipText: "Column ‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á CSV ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô 01_Somchai)",
        resultTitle: "üìÑ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå",
        resultEmpty: "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å Generate",
        errorTitle: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
        btnClose: "‡∏õ‡∏¥‡∏î",
        downloadAll: "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (.zip)",
        generated: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        files: "‡πÑ‡∏ü‡∏•‡πå",
        progressStart: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô...",
        progressWork: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£...",
        // Error Messages
        ERR_MISSING_FILES: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á Template ‡πÅ‡∏•‡∏∞ CSV",
        ERR_INVALID_TEMPLATE: "‡πÑ‡∏ü‡∏•‡πå Template ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô .docx ‡∏´‡∏£‡∏∑‡∏≠ .pptx ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô",
        ERR_TEMPLATE_MISMATCH: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó Template ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Output (‡πÄ‡∏ä‡πà‡∏ô Template ‡πÄ‡∏õ‡πá‡∏ô PPT ‡πÅ‡∏ï‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Output ‡πÄ‡∏õ‡πá‡∏ô Word)",
        ERR_CSV_EMPTY: "‡πÑ‡∏ü‡∏•‡πå CSV ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
        ERR_UNKNOWN: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏",
        footer: "‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ Yutthana P. ¬© 2025" 
      },
      en: {
        appTitle: "EasyCert",
        appSubtitle: "Online Certificate Generator",
        step1: "1) Upload Template (.docx / .pptx)",
        dragTemplate: "Drag & Drop Template or Click",
        hint1: "Use {{Tag}} in template matching CSV column headers",
        step2: "2) Upload Data (.csv)",
        dragCsv: "Drag & Drop CSV or Click",
        hint2: "First row must contain headers e.g. Name, Date",
        step3: "3) Select Output Type",
        btnGenerate: "‚ö° Generate Documents",
        btnProcessing: "Processing...",
        tipLabel: "Tip:",
        tipText: "The first column of CSV will be used as the filename (e.g. 01_Name)",
        resultTitle: "üìÑ Results",
        resultEmpty: "Results will appear here after generation",
        errorTitle: "Error Occurred",
        btnClose: "Close",
        downloadAll: "Download All (.zip)",
        generated: "Generated",
        files: "files",
        progressStart: "Starting...",
        progressWork: "Generating documents...",
        // Error Messages
        ERR_MISSING_FILES: "Please upload both Template and CSV files.",
        ERR_INVALID_TEMPLATE: "Template must be .docx or .pptx file.",
        ERR_TEMPLATE_MISMATCH: "Template type does not match Output (e.g., using PPT template for Word output).",
        ERR_CSV_EMPTY: "CSV file is empty or invalid.",
        ERR_UNKNOWN: "An unknown error occurred.",
        footer: "Developed by Yutthana P. ¬© 2025" 
      }
    };

    let currentLang = 'th';
    let currentErrorKey = null;

    // --- Helper: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á Error) ---
    function setTextSafe(id, text) {
      const el = document.getElementById(id);
      if (el) el.textContent = text;
    }

    function setLanguage(lang) {
      currentLang = lang;
      const t = translations[lang];

      // ‡πÉ‡∏ä‡πâ setTextSafe ‡πÅ‡∏ó‡∏ô getElementById ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
      setTextSafe('t-app-title', t.appTitle);
      setTextSafe('t-app-subtitle', t.appSubtitle);
      setTextSafe('t-step1', t.step1);
      setTextSafe('t-drag-template', t.dragTemplate);
      setTextSafe('t-hint1', t.hint1);
      setTextSafe('t-step2', t.step2);
      setTextSafe('t-drag-csv', t.dragCsv);
      setTextSafe('t-hint2', t.hint2);
      setTextSafe('t-step3', t.step3);

      const btn = document.getElementById('submitBtn');
      if (btn) btn.textContent = btn.disabled ? t.btnProcessing : t.btnGenerate;

      setTextSafe('t-tip-label', t.tipLabel);
      setTextSafe('t-tip-text', t.tipText);
      setTextSafe('t-result-title', t.resultTitle);
      setTextSafe('t-result-empty', t.resultEmpty);
      setTextSafe('t-error-title', t.errorTitle);
      setTextSafe('t-error-close', t.btnClose);

      // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Error ‡πÉ‡∏ô Modal (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà)
      if (currentErrorKey) {
        setTextSafe("errorMessage", t[currentErrorKey] || currentErrorKey);
      }

      //Footer
      setTextSafe('t-footer', t.footer);

      // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÅ‡∏´‡∏•‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á)
      document.getElementById('btn-th').classList.toggle('active', lang === 'th');
      document.getElementById('btn-en').classList.toggle('active', lang === 'en');
    }

    function openError(keyOrMessage) {
      currentErrorKey = keyOrMessage;
      const t = translations[currentLang];
      const msg = t[keyOrMessage] || keyOrMessage;

      setTextSafe('t-error-title', t.errorTitle); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      setTextSafe('errorMessage', msg);

      document.getElementById("errorOverlay").classList.add("visible");
    }

    function closeError() {
      document.getElementById("errorOverlay").classList.remove("visible");
      currentErrorKey = null;
    }

    /* --- Logic ‡πÄ‡∏î‡∏¥‡∏° --- */
    function setupDragDrop(zoneId, inputId, contentId, successId, nameId) {
      const zone = document.getElementById(zoneId);
      const input = document.getElementById(inputId);
      const content = document.getElementById(contentId);
      const success = document.getElementById(successId);
      const nameLabel = document.getElementById(nameId);

      zone.addEventListener('click', () => input.click());
      input.addEventListener('change', () => { if (input.files.length) updateUI(input.files[0]); });
      zone.addEventListener('dragover', (e) => { e.preventDefault(); zone.classList.add('dragover'); });
      zone.addEventListener('dragleave', () => zone.classList.remove('dragover'));
      zone.addEventListener('drop', (e) => {
        e.preventDefault(); zone.classList.remove('dragover');
        if (e.dataTransfer.files.length) { input.files = e.dataTransfer.files; updateUI(e.dataTransfer.files[0]); }
      });
      function updateUI(file) {
        content.style.display = 'none'; success.style.display = 'flex';
        nameLabel.textContent = file.name; zone.classList.add('has-file');
      }
    }
    setupDragDrop('dropZoneTemplate', 'fileTemplate', 'contentTemplate', 'successTemplate', 'nameTemplate');
    setupDragDrop('dropZoneCsv', 'fileCsv', 'contentCsv', 'successCsv', 'nameCsv');

    function getFileIcon(filename) {
      const ext = filename.split('.').pop().toLowerCase();
      if (ext === 'pdf') return `<div class="file-icon-box" style="background: #fee2e2; color: #ef4444;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></div>`;
      if (ext === 'docx' || ext === 'doc') return `<div class="file-icon-box" style="background: #dbeafe; color: #2563eb;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline><text x="8" y="19" font-size="6" font-weight="bold" fill="currentColor" stroke="none">W</text></svg></div>`;
      if (ext === 'pptx' || ext === 'ppt') return `<div class="file-icon-box" style="background: #ffedd5; color: #f97316;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><rect x="8" y="13" width="8" height="6" rx="1" stroke="currentColor"></rect><line x1="8" y1="13" x2="16" y2="13"></line><text x="9" y="17.5" font-size="4" font-weight="bold" fill="currentColor" stroke="none">P</text></svg></div>`;
      if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) return `<div class="file-icon-box" style="background: #dcfce7; color: #16a34a;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></div>`;
      return `<div class="file-icon-box" style="background: #f3f4f6; color: #6b7280;"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg></div>`;
    }

    const form = document.getElementById("mergeForm");
    const submitBtn = document.getElementById("submitBtn");
    const resultContent = document.getElementById("resultContent");
    const downloadAllContainer = document.getElementById("downloadAllContainer");
    let progressInterval = null;

    function updateProgressBar(percent) {
      const fill = document.getElementById('progressFill');
      const text = document.getElementById('progressText');
      if (fill && text) {
        const t = translations[currentLang];
        fill.style.width = percent + '%';
        text.textContent = `${t.progressWork} ${percent}%`;
      }
    }

    window.markAsDownloaded = function (btn) {
      btn.classList.add('downloaded');
      btn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
    }

    function showLoading() {
      const t = translations[currentLang];
      downloadAllContainer.innerHTML = '';
      resultContent.innerHTML = `
        <div class="loading-container">
            <div class="progress-wrapper">
                <div class="progress-track"><div id="progressFill" class="progress-fill"></div></div>
                <div id="progressText" class="progress-text">${t.progressStart} 0%</div>
            </div>
            <div style="width: 100%; max-width: 400px; margin-top: 10px;">
                <div class="skeleton-bar" style="width: 100%"></div>
                <div class="skeleton-bar" style="width: 90%"></div>
            </div>
        </div>
      `;
      let percent = 0; updateProgressBar(0);
      if (progressInterval) clearInterval(progressInterval);
      progressInterval = setInterval(() => {
        if (percent < 60) percent += Math.floor(Math.random() * 5) + 1;
        else if (percent < 90) percent += 1;
        if (percent > 90) percent = 90;
        updateProgressBar(percent);
      }, 300);
    }

    function showResults(label, files, zipBase64) {
      if (progressInterval) clearInterval(progressInterval);
      updateProgressBar(100);

      setTimeout(() => {
        const t = translations[currentLang];
        downloadAllContainer.innerHTML = `
            <a href="data:application/zip;base64,${zipBase64}" download="all-files.zip" class="btn-download-all-header">
              ${t.downloadAll}
            </a>
          `;

        let listHtml = `<div class="result-summary">${t.generated} ${files.length} ${t.files} (${label})</div>`;
        listHtml += `<div class="file-list">`;

        files.forEach(f => {
          const fileIconHtml = getFileIcon(f.filename);
          const downloadIconSvg = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>`;

          listHtml += `
              <div class="file-item">
                <div class="file-info">
                  ${fileIconHtml}
                  <span class="file-name-text">${f.filename}</span>
                </div>
                <a href="data:${f.mime};base64,${f.base64}" download="${f.filename}" 
                   class="btn-icon-download" title="Download" onclick="markAsDownloaded(this)">
                  ${downloadIconSvg}
                </a>
              </div>
            `;
        });
        listHtml += `</div>`;
        resultContent.innerHTML = listHtml;
      }, 500);
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!form.reportValidity()) return;
      const t = translations[currentLang];

      submitBtn.disabled = true;
      submitBtn.textContent = t.btnProcessing;
      showLoading();

      try {
        const fd = new FormData(form);
        const res = await fetch("/merge", { method: "POST", body: fd });
        const data = await res.json().catch(() => null);
        if (!res.ok || !data || !data.success) throw new Error(data?.message || "ERR_UNKNOWN");
        showResults(data.label, data.files, data.zipBase64);
      } catch (err) {
        if (progressInterval) clearInterval(progressInterval);

        /* --- üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ: ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏≤‡∏¢‡∏ü‡πâ‡∏≤) ‡πÅ‡∏ó‡∏ô‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Error --- */
        resultContent.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon">‚ö°</div>
            <p id="t-result-empty">${t.resultEmpty}</p>
          </div>
        `;
        /* ------------------------------------------------------------- */

        openError(err.message); // ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÅ‡∏™‡∏î‡∏á Popup Error ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = t.btnGenerate;
      }
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    setLanguage('th');
  </script>
</body>

</html>